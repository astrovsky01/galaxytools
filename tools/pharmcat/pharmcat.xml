<tool id="pharmcat" name="pharmcat" version="@WRAPPER_VERSION@+@VERSION_SUFFIX@" profile="20.01">
    <macros>
        <token name="@WRAPPER_VERSION@">1.3.1</token>
        <token name="@VERSION_SUFFIX@">galaxy0</token>
    </macros>
    <requirements>
        <requirement type="package" version="@WRAPPER_VERSION@">pharmcat</requirement>
    </requirements>
    <command detect_errors="exit_code"><![CDATA[
        pharmcat
        -vcf $input
        #if $function_select.function == "name":
            -json output.json
            -html output.html
        #else if $function_select.function == "pheno":
            -c $function_select.named_data
            -f output.json
            #if $function_select.outside_call:
                -o $function_select.outside_call
            #end if
        #else if $function_select.function == "report":
            -p $function_select.pheno_data
            -j output.json
            -o output,html
            #if $function_select.title:
                -o $function_select.title
            #end if 
        #else:
            -o output
            -f output
            #if $function_select.outside_call:
                -a $function_select.outside_call
            #end if 
            $function_select.keep
            $function_select.json
            $function_select.phenojson
        #end if
    ]]></command>
    <inputs>
        <param name="input" argument="-vcf" type="data" format="vcf" label="Input vcf file" help="Must be formatted in modified official VCF format as detailed here: https://github.com/PharmGKB/PharmCAT/wiki/VCF-Requirements"/>
        <conditional name="function_select">
            <param name="function" type="select" label="Which function of PharmCAT should be run?">
                <option value="all">Full PharmCAT pipeline</option>
                <option value="name">Only named allele matcher</option>
                <option value="pheno">Only phenotyper</option>
                <option value="report">Only reporter</option>
            </param>
            <when value="all">
                <param name="outside_call" argument="-a" type="data" format="tsv,tabular" label="Gene call TSV file from an outside tool" optional="true"/>
                <param name="keep" argument="-k" type="boolean" truevalue="-k" falsevalue="" label="Keep interim output files from NamedAlleleMatcher"/>
                <param name="json" argument="-j" type="boolean" truevalue="-j" falsevalue="" label="Output reporter JSON report"/>
                <param name="phenojson" argument="-pj" type="boolean" truevalue="-pj" falsevalue="" label="Output phenotyper JSON report"/>
                <!-- <param name="definitions" argument="-na" type="data" format="list" label="Alternative allele definitions" help="a directory containing allele definitions to use instead of the default packaged allele definitions"/> -->
            </when>
            <when value="name">
                <!-- <param name="definitions" argument="-d" type="data" format="list" label="Alternative allele definitions" help="a directory containing allele definitions to use instead of the default packaged allele definitions"/> -->
            </when>
            <when value="pheno">
                <param name="named_data" argument="-c" type="data" format="json" label="JSON call data output from NamedAlleleMatcher"/>
                <param name="outside_call" argument="-o" type="data" format="tsv,tabular" label="Gene call TSV file from an outside tool" optional="true"/>
            </when>
            <when value="report">
                <param name="pheno_data" argument="-p" type="data" format="json" label="JSON call data output from NamedAlleleMatcher"/>
                <param name="title" argument="-t" type="text" label="Text to add to the report title" optional="true"/>
            </when>
        </conditional>
    </inputs>
    <outputs>
    </outputs>
    <tests>
        <test>
        </test>
    </tests>
    <help><![CDATA[
        PharmCAT is a tool to extract all CPIC guideline gene variants from a genetic dataset (represented as a VCF file), interpret the variant alleles, and generate a report.
    ]]></help>
    <citations>
        <citation type="doi" >10.1002/cpt.928</citation>
    </citations>
</tool>